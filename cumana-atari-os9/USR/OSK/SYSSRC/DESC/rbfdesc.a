 ttl Device Descriptor for Floppy disk controller* Copyright 1984, 1985, 1986, 1987, 1988, 1989 by Microware Systems* Corporation.* Reproduced Under License.* This source code is the proprietary confidential property of* Microware Systems Corporation, and is provided to licensee* solely for documentation and educational purposes. Reproduction,* publication, or distribution in any form to any party other* than the licensee is prohibited.********************************* Edition History*  #   date    comments                                         by* -- -------- ------------------------------------------------- ---* 00 83/12/05 Converted to 68000 from 6809 edition 1.           res* 00 84/04/06 Added FlpyName macro usage                        WGP* 00 84/04/06 Added defs for some variable opts                 WGP* 01 84/10/12 Added IRQ Level & resesrved bytes.                rfd* 02 85/11/07 Split into seperate files                         res* 03 85/06/27 Added mode byte.									rfd* 04 85/06/25 Added sector size, format control, retry control.	res* 05 86/09/15 Added write precomp, reduced write current, park *             cylinder, scsi unit number, scsi controller id,*             total number of cylinders and offset.             djl*             <<<---- OS-9/68000 V2.1 Release ---->>>*             <<<---- OS-9/68000 V2.2 Release ---->>>* 06 88/04/27 Added "ramdisk" and "nvramdisk" defaults.         wwb* 07 88/05/02 Added "uv580" defaults.                           wwb* 08 88/09/22 Made TotalCyls match Cylnders.                    wwb* 09 88/11/22 Added "autosize" defaults.                        wwb* 10 89/02/27 added scsi option flags.                          wwb* 11 89/03/02 added dd380 and uv380 default types, removed all  wwb*             "DevCon set 0's" except for ram disk.*             <<<---- OS-9/68000 V2.3 Release ---->>>*Edition equ 11 current edition number* PD_DNS valuesSingle   equ 0Double   equ 1* PD_TYP valuesFive     equ 0<<0  drive is 5 1/4"Eight    equ 1<<0  drive is 8"Hard     equ 1<<7  hard disk media* PD_VFY valuesON       equ 1 "no-verify" ONOFF      equ 0 "no-verify" OFF (i.e. verify is ON!)* macro parameter #6 definitions (drive type)d877     equ 1 single density 8"dd877    equ 4 double density 8"d540     equ 2 single density 5" 40 trkdd540    equ 5 double density 5" 40 trkd580     equ 3 single density 5" 80 trkdd580    equ 6 double density 5" 80 trkramdisk  equ 7 volatile ram disknvramdisk equ 8 non-volatile ram diskuv580    equ 9 universal 5" 80 trackautosize equ 10 autosize device (SS_DSize tells media size)dd380    equ 11 double density 3 1/2", 80 trkuv380    equ 12 universal 3 1/2" 80 trackcum380   equ 13 cumana 3 1/2" 80 track, 18 sectors/trackstd380   equ 14 "standard" 3 1/2" 80 track, 16 sectors/track, sector offset 1Density  set BitDns+(TrkDns<<1)DiskType set DiskKind+(DnsTrk0<<5)TypeLang set (Devic<<8)+0Attr_Rev set (ReEnt<<8)+0 psect RBFDesc,TypeLang,Attr_Rev,Edition,0,0 dc.l Port port address dc.b Vector auto-vector trap assignment dc.b IRQLevel IRQ hardware interrupt level dc.b Priority irq polling priority dc.b Mode device mode capabilities dc.w FileMgr file manager name offset dc.w DevDrv device driver name offset dc.w DevCon (reserved) dc.w 0,0,0,0 reserved dc.w OptLen* Default ParametersOptTbl dc.b DT_RBF device type dc.b DrvNum drive number dc.b StepRate step rate dc.b DiskType type of disk 8"/5"/Hard dc.b Density Bit Density and track density dc.b 0 reserved dc.w Cylnders-TrkOffs number of cylinders dc.b Heads Number of Sides (Floppy) Heads(Hard Disk) dc.b NoVerify OFF = disk verify ON = no verify dc.w SectTrk default sectors/track dc.w SectTrk0 default sectors/track track 0 dc.w SegAlloc segment allocation size dc.b Intrleav sector interleave factor dc.b DMAMode DMA mode (none) dc.b TrkOffs track base offset dc.b SectOffs sector base offset dc.w SectSize # of bytes/sector dc.w Control format control byte dc.b Trys number of retrys 0 = no retrys/error correction dc.b ScsiLun scsi logical unit number dc.w WrtPrecomp write precomp cylinder dc.w RedWrtCrnt reduce write current cylinder dc.w ParkCyl cylinder to park head for hard disk dc.l LSNOffset logical sector offset dc.w TotalCyls total cylinders on drive dc.b CtrlrID scsi controller id dc.b 0 reserved (alignment) dc.l ScsiOpts scsi option flagsOptLen equ *-OptTblFileMgr dc.b "RBF",0 Random block file managerRBFDesc macroPort     equ \1 Port addressVector   equ \2 autovector numberIRQLevel equ \3 hardware interrupt level Priority equ \4 polling priorityDevDrv   dc.b "\5",0 driver module name ifgt \#-5 standard device setup requested? ifeq \6-d877  8", 77 track drive, single densityDiskKind  set EightCylnders  set 77BitDns    set Single FM encodingTrkDns    set Single 48 tpiSectTrk   set 16SectTrk0  set 16 TotalCyls set Cylnders number of actual cylinders on disk endc ifeq \6-dd877  8", 77 track, double densityDiskKind  set EightCylnders  set 77BitDns    set Double MFM encodingTrkDns    set Single 48 tpiSectTrk   set 28SectTrk0  set 16 TotalCyls set Cylnders number of actual cylinders on disk endc ifeq \6-d540 5", 40 track drive, single densityDiskKind  set FiveCylnders  set 40BitDns    set Single FM encodingTrkDns    set Single 48 tpiSectTrk   set 10SectTrk0  set 10 TotalCyls set Cylnders number of actual cylinders on disk endc ifeq \6-dd540 5", 40 track, double density driveDiskKind  set FiveCylnders  set 40BitDns    set Double MFM encodingTrkDns    set Single 48 tpiSectTrk   set 16SectTrk0  set 10 TotalCyls set Cylnders number of actual cylinders on disk endc ifeq \6-d580 5", 80 track, single density driveDiskKind  set FiveCylnders  set 80 BitDns    set Single FM encodingTrkDns    set Double 96 tpiSectTrk   set 10SectTrk0  set 10 TotalCyls set Cylnders number of actual cylinders on disk endc ifeq \6-dd580 5", 80 track drive, double densityDiskKind  set FiveCylnders  set 80 BitDns    set Double MFM encodingTrkDns    set Double 96 tpiSectTrk   set 16SectTrk0  set 10TotalCyls set Cylnders number of actual cylinders on disk endc ifeq \6-ramdisk volatile ram diskDiskKind  set 0Cylnders  set 0BitDns    set SingleTrkDns    set SingleSectTrk0  set 0Heads     set 0StepRate  set 0Intrleav  set 0NoVerify  set ONSegAlloc  set 4Trys      set 0DevCon    set 0 not used by ram-disk driverControl   set 0 format enabled endc ifeq \6-nvramdisk non-volatile ram diskDiskKind  set 0Cylnders  set 0BitDns    set SingleTrkDns    set SingleSectTrk0  set 0Heads     set 0StepRate  set 0Intrleav  set 0NoVerify  set ONSegAlloc  set 4Trys      set 0DevCon    set 0 not used by ram disk driverControl   set FmtDsabl nvram disks are format disabled endc  ifeq \6-uv580 universal 5" 80 trackDiskKind  set Five   five inch diskCylnders  set 80     number of (physical) tracksBitDns    set Double MFM recordingDnsTrk0   set Double MFM track 0TrkDns    set Double 96tpiSectTrk   set 16     sectors/track (except trk 0, side 0)SectTrk0  set 16     sectors/track, track 0, side 0SectOffs  set 1      physical sector start = 1TrkOffs   set 1      track 0 not usedTotalCyls set Cylnders number of actual cylinders on disk endc  ifeq \6-autosize "autosize" device (SS_DSize tells capacity)SectTrk   set 0      sectors/track (except trk 0, side 0)SectTrk0  set 0      sectors/track, track 0, side 0Cylnders  set 0      total cylindersHeads     set 0      total headsBitDns    set DoubleTrkDns    set Double*Control   set Control+AutoEnabl set "autosize" media. endc ifeq \6-dd380 3 1/2", 80 track driveDiskKind  set Five   use 5 1/4" transfer rateCylnders  set 80 BitDns    set DoubleTrkDns    set DoubleSectTrk   set 16SectTrk0  set 10TotalCyls set Cylnders number of actual cylinders on disk endc ifeq \6-uv380 universal 3 1/2" 80 trackDiskKind  set Five   use 5 1/4" transfer rateCylnders  set 80     number of (physical) tracksBitDns    set Double MFM recordingDnsTrk0   set Double MFM track 0TrkDns    set Double 96tpiSectTrk   set 16     sectors/track (except trk 0, side 0)SectTrk0  set 16     sectors/track, track 0, side 0SectOffs  set 1      physical sector start = 1TrkOffs   set 1      track 0 not usedTotalCyls set Cylnders number of actual cylinders on disk endc ifeq \6-cum380 cumana 3 1/2" 80 trackDiskKind  set Five   use 5 1/4" transfer rateCylnders  set 80     number of (physical) tracksBitDns    set Double MFM recordingDnsTrk0   set Double MFM track 0TrkDns    set Double 96tpiSectTrk   set 18     sectors/track (except trk 0, side 0)SectTrk0  set 18     sectors/track, track 0, side 0SectOffs  set 0      physical sector start = 0TrkOffs   set 0      track offset 0TotalCyls set Cylnders number of actual cylinders on disk endc ifeq \6-std380 std 3 1/2" 80 trackDiskKind  set Five   use 5 1/4" transfer rateCylnders  set 80     number of (physical) tracksBitDns    set Double MFM recordingDnsTrk0   set Double MFM track 0TrkDns    set Double 96tpiSectTrk   set 16     sectors/track (except trk 0, side 0)SectTrk0  set 16     sectors/track, track 0, side 0SectOffs  set 1      physical sector start = 1TrkOffs   set 0      track offset 0TotalCyls set Cylnders number of actual cylinders on disk endc endc endm***************** Descriptor DefaultsMode     set Dir_+ISize_+Exec_+Updat_BitDns   set SingleHeads    set 2 StepRate set 2Intrleav set 3 NoVerify set OFFDnsTrk0  set SingleDMAMode  set 0 non dma deviceSegAlloc set 8 minimum segment allocation sizeTrkOffs  set 0SectOffs set 0SectSize set 256 default sector size  256 bytes.WrtPrecomp set 0 no write precompRedWrtCrnt set 0 no reduced write currentParkCyl set 0 where to park the head for hard diskScsiLun set 0 scsi logical unit numberCtrlrID set 0 controller idLSNOffset set 0 logical sector offset for scsi hard disksTotalCyls set 0 number of actual cylinders on disk* scsi options flag definitionsscsi_atn    set 1<<0 assert ATN supportedscsi_target set 1<<1 target mode supportedscsi_synchr set 1<<2 synchronous transfers supportedscsi_parity set 1<<3 enable SCSI parityScsiOpts set 0 scsi options flags* device control word definitionsFmtEnabl  set 0<<0 enable formattingFmtDsabl  set 1<<0 disable formattingMultDsabl set 0<<1 disable multi-sectorsMultEnabl set 1<<1 enable multi-sectorsStabDsabl set 0<<2 device doesn't have stable idStabEnabl set 1<<2 device has stable idAutoDsabl set 0<<3 device size from device descriptorAutoEnabl set 1<<3 device tells size via SS_DSizeFTrkDsabl set 0<<4 device can't format a single trackFTrkEnabl set 1<<4 device can format a single trackControl set 0Trys set 7 number of Trys