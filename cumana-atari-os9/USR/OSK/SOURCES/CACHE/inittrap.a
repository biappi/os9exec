 psect inittrap,0,0,0,0,0 vsectmodptr dc.l btext pointer to beginning of module ends*   install user trap handler**	The trap handler is installed via _utinit, which is called by*	cstart.r when no trap handler is installed for the vector.  Other*	handlers are installed the same way as shown below.**	Input:		d0.w user trap vector number**	Output:		(a0) trap handler name string*				(a1) trap handler execution entry point*				cc	 set if error, d1.w=error code*_utinit: movem.l d2-d5/a2-a4,-(sp) cmpi.w #CT$Trap,d0 our handler desired? bne.s ret98 bra if not moveq #0,d1 clear additional memory lea cttrapnam(pc),a0 get module name ptr lea errno(a6),a3 get error number ptr move.l environ(a6),d3 get environment ptr movea.l modptr(a6),a4 get pointer to module os9 F$TLink install trap module bcs.s ret99 something is afoul cmpi.w #2,M$Edit(a2) can we handle this edition? bge.s ret99 edition matches (or later...)! lea badmsg(pc),a0 message string moveq #100,d1 bytecount moveq #2,d0 path os9 I$WritLnret98 lea cttrapnam(pc),a0 name of the trap handler moveq #E$MNF,d1 say its not found ori.w #1,ccr set carryret99 movem.l (sp)+,d2-d5/a2-a4 rtscttrapnam dc.b "cttrap" dc.b 0badmsg dc.b "**** cttrap handler mismatch ****" dc.b 0 ends